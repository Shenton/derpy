exports.ids=[8],exports.modules={36:function(e,t,r){"use strict";r.r(t);var o={name:"mp3",fetch:({store:e,redirect:t})=>e.state.auth.isAuth&&e.state.auth.hasAccess?void 0:t("/"),head(){return{titleTemplate:"%s - "+this.title}},data:()=>({title:"Module: mp3",mp3s:[],fields:[{key:"mp3",label:"mp3",sortable:!0,thStyle:{width:"80%"}},{key:"enabledCheckBox",label:"Activé",sortable:!0,thStyle:{width:"20%"}}],totalRows:1,currentPage:1,perPage:10,pageOptions:[5,10,15],showNewForm:!0,newMP3:null,uploadDisabled:!0,isUploading:!1,uploadProgress:50,uploadProgressMax:100,uploadVariant:"primary"}),async asyncData({$axios:e}){try{return{mp3s:(await e.$get("mp3")).map(e=>({...e,key:`${e._id}/${e.revision}`}))}}catch(e){}},mounted(){this.$store.dispatch("breadcrumbs/setCrumbs",this.$route.path),this.totalRows=this.mp3s.length},computed:{newMP3Validation(){return this.newMP3?"audio/mpeg"===this.newMP3.type&&(!(this.newMP3.size>1048576)&&/^[a-z0-9]{3,10}\.mp3$/.test(this.newMP3.name)):null}},methods:{async getMP3s(){try{const data=await this.$axios.$get("mp3");this.mp3s=data.map(e=>({...e,key:`${e._id}/${e.revision}`})),this.totalRows=this.mp3s.length}catch(e){this.$axiosGetErrorHandler(e)}},async uploadFile(e){e.preventDefault();try{const e=this,t=new FormData;t.append("file",this.newMP3),this.isUploading=!0;await this.$axios({method:"post",url:"mp3/upload",data:t,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(t){e.uploadProgress=Math.round(t.loaded/t.total*100)}});this.uploadVariant="success",this.$toast.success("Fichier téléversé"),setTimeout(()=>{this.newMP3=null,this.isUploading=!1,this.uploadProgress=0,this.uploadVariant="primary",this.getMP3s()},5e3)}catch(e){const code=parseInt(e.response&&e.response.status);404===code?this.$toast.warning("Aucun fichier téléversé"):415===code?this.$toast.warning("Mauvais type de fichier"):413===code?this.$toast.warning("Fichier trop volumineux"):400===code?this.$toast.warning("Nom de fichier ou extension invalide"):409===code?this.$toast.warning("Le fichier existe déjà"):this.$toast.warning("Erreur avec le téléversement du fichier"),this.uploadVariant="danger",setTimeout(()=>{this.newMP3=null,this.isUploading=!1,this.uploadProgress=0,this.uploadVariant="primary"},5e3)}},async submitUpdate(e,data){try{0===(await this.$axios({method:"patch",data:data,url:"mp3/"+e})).data.modifed?this.$toast.warning("Aucune modification"):(this.$toast.success("mp3 modifié"),this.getMP3s())}catch(e){this.axiosPostError(e,"Erreur avec l'édition du mp3")}},async submitDelete(e){try{await this.$axios({method:"delete",url:"mp3/"+e}),this.$toast.success("mp3 supprimé"),this.getMP3s()}catch(e){this.axiosPostError(e,"Erreur avec la suppression du mp3")}},axiosPostError(e,t){this.$axiosPostErrorHandler(e,"mp3 non trouvée","Ce mp3 existe déjà",t)},toggleEnabled(e,t){t?this.submitUpdate(e,{enabled:!1}):this.submitUpdate(e,{enabled:!0})},resetNew(e){e&&e.preventDefault(),this.newForm.mp3="",this.showNewForm=!1,this.$nextTick(()=>{this.showNewForm=!0})}}},n=r(1),component=Object(n.a)(o,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-jumbotron",{staticClass:"mt-3 mb-3 pt-4 pb-4",attrs:{fluid:"","bg-variant":"dark","text-variant":"light",header:"Module: mp3",lead:"Joue des courts mp3 sur les canaux vocaux."}}),e._ssrNode(" "),r("b-container",[r("b-breadcrumb",{attrs:{items:e.$store.state.breadcrumbs.crumbs}})],1),e._ssrNode(" "),e.mp3s.length?r("b-container",{staticClass:"pb-5"},[r("b-table",{attrs:{hover:"","head-variant":"light","current-page":e.currentPage,"per-page":e.perPage,items:e.mp3s,fields:e.fields},scopedSlots:e._u([{key:"enabledCheckBox",fn:function(t){return[r("b-form",[r("b-form-checkbox",{attrs:{name:"check-button",switch:""},on:{change:function(r){return e.toggleEnabled(t.item._id,t.item.enabled)}},model:{value:t.item.enabled,callback:function(r){e.$set(t.item,"enabled",r)},expression:"row.item.enabled"}})],1)]}}],null,!1,2829410011)}),e._v(" "),r("b-row",[r("b-col",[r("b-pagination",{staticClass:"my-0",attrs:{"total-rows":e.totalRows,"per-page":e.perPage},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}})],1),e._v(" "),r("b-col",[r("b-form-group",{staticClass:"mb-0",attrs:{"label-cols-sm":"3",label:"Nombre par page"}},[r("b-form-select",{attrs:{options:e.pageOptions},model:{value:e.perPage,callback:function(t){e.perPage=t},expression:"perPage"}})],1)],1)],1)],1):e._e(),e._ssrNode(" "),r("b-container",[r("h4",[e._v("Ajouter un nouveau mp3")]),e._v(" "),r("hr",{staticClass:"border-primary"}),e._v(" "),e.showNewForm?r("b-form",[e.isUploading?r("b-form-group",[r("b-progress",{attrs:{max:e.uploadProgressMax,height:"2.5rem","show-progress":"","show-value":""}},[r("b-progress-bar",{attrs:{value:e.uploadProgress,variant:e.uploadVariant}},[e._v("\r\n                        Progression: "),r("strong",[e._v(e._s(e.uploadProgress)+"%")])])],1)],1):r("b-form-group",[r("b-form-file",{attrs:{name:"newMP3",placeholder:"Choisir un fichier mp3",accept:".mp3",state:e.newMP3Validation},model:{value:e.newMP3,callback:function(t){e.newMP3=t},expression:"newMP3"}}),e._v(" "),r("b-form-invalid-feedback",{attrs:{state:e.newMP3Validation}},[e._v("\r\n                    Le fichier doit être un mp3 de 1mo max, le nom ne doit contenir que des lettres minuscules ou des chiffres et être compris entre 3 et 10 charactères.\r\n                ")])],1),e._v(" "),r("b-form-group",[r("b-button",{attrs:{variant:"primary",disabled:!e.newMP3Validation},on:{click:e.uploadFile}},[e._v("Téléverser")]),e._v(" "),r("b-button",{attrs:{variant:"secondary"},on:{click:function(t){e.newMP3=null}}},[e._v("Annuler")])],1)],1):e._e()],1)],2)},[],!1,null,null,"b39ed4c2");t.default=component.exports}};
//# sourceMappingURL=b646397b2a8ff91f94af.js.map