(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{204:function(t,e,r){"use strict";r.r(e);var n=r(0),c=(r(42),r(13)),o={name:"activity-update-form",props:["data"],data:function(){return{activityID:"",trigger:"",activity:"",type:""}},mounted:function(){this.activityID=this.data._id,this.activity=this.data.activity},methods:{submitUpdate:function(t){t.preventDefault(),this.$emit("submitUpdate",this.activityID,{activity:this.activity})},submitDelete:function(){this.$emit("submitDelete",this.activityID)}}},l=r(24),v=Object(l.a)(o,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:" p-3"},[r("b-form",{on:{submit:t.submitUpdate}},[r("b-form-group",[r("b-form-input",{attrs:{required:""},model:{value:t.activity,callback:function(e){t.activity=e},expression:"activity"}})],1),t._v(" "),r("b-form-group",[r("b-button",{attrs:{type:"submit",variant:"primary"}},[t._v("Modifier")]),t._v(" "),t.$store.state.auth.isOwner?r("b-button",{staticClass:"float-right",attrs:{variant:"danger"},on:{click:t.submitDelete}},[t._v("Supprimer")]):t._e()],1)],1)],1)},[],!1,null,null,null).exports,h={name:"Activity",fetch:function(t){var e=t.store,r=t.redirect;return e.state.auth.isAuth&&e.state.auth.hasAccess?void 0:r("/")},head:function(){return{titleTemplate:"%s - "+this.title}},data:function(){return{title:"Module: Activity",activities:[],fields:[{key:"activity",label:"Activité",sortable:!0,thStyle:{width:"80%"}},{key:"enabledCheckBox",label:"Activée",sortable:!0,thStyle:{width:"20%"}}],totalRows:1,currentPage:1,perPage:10,pageOptions:[5,10,15],showNewForm:!0,newForm:{activity:""}}},asyncData:function(){var t=Object(c.a)(regeneratorRuntime.mark(function t(e){var r,data,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$axios,t.prev=1,t.next=4,r.$get("activity");case 4:return data=t.sent,c=data.map(function(t){return Object(n.a)({},t,{_showDetails:!1,key:"".concat(t._id,"/").concat(t.revision)})}),t.abrupt("return",{activities:c});case 9:t.prev=9,t.t0=t.catch(1);case 11:case"end":return t.stop()}},t,null,[[1,9]])}));return function(e){return t.apply(this,arguments)}}(),mounted:function(){this.$store.dispatch("breadcrumbs/setCrumbs",this.$route.path),this.totalRows=this.activities.length},methods:{submitNew:function(){var t=Object(c.a)(regeneratorRuntime.mark(function t(e){var data;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.prev=1,t.next=4,this.$axios({method:"post",data:{activity:this.newForm.activity},url:"activity"});case 4:return t.sent,this.$toast.success("Activité ajoutée"),this.resetNew(),t.prev=7,t.next=10,this.$axios.$get("activity");case 10:data=t.sent,this.activities=data.map(function(t){return Object(n.a)({},t,{_showDetails:!1,key:"".concat(t._id,"/").concat(t.revision)})}),this.totalRows=this.activities.length,t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),this.$axiosGetErrorHandler(t.t0);case 18:t.next=23;break;case 20:t.prev=20,t.t1=t.catch(1),this.axiosPostError(t.t1,"Erreur avec l'ajout de l'activité");case 23:case"end":return t.stop()}},t,this,[[1,20],[7,15]])}));return function(e){return t.apply(this,arguments)}}(),submitUpdate:function(){var t=Object(c.a)(regeneratorRuntime.mark(function t(e,data){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.hideRowDetails(),t.prev=1,t.next=4,this.$axios({method:"patch",data:data,url:"activity/"+e});case 4:if(0!==t.sent.data.modifed){t.next=9;break}this.$toast.warning("Aucune modification"),t.next=21;break;case 9:return this.$toast.success("Activité modifiée"),t.prev=10,t.next=13,this.$axios.$get("activity");case 13:r=t.sent,this.activities=r.map(function(t){return Object(n.a)({},t,{_showDetails:!1,key:"".concat(t._id,"/").concat(t.revision)})}),this.totalRows=this.activities.length,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(10),this.$axiosGetErrorHandler(t.t0);case 21:t.next=26;break;case 23:t.prev=23,t.t1=t.catch(1),this.axiosPostError(t.t1,"Erreur avec l'édition de l'activité");case 26:case"end":return t.stop()}},t,this,[[1,23],[10,18]])}));return function(e,r){return t.apply(this,arguments)}}(),submitDelete:function(){var t=Object(c.a)(regeneratorRuntime.mark(function t(e){var data;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.hideRowDetails(),t.prev=1,t.next=4,this.$axios({method:"delete",url:"activity/"+e});case 4:return this.$toast.success("Activité supprimée"),t.prev=5,t.next=8,this.$axios.get("activity");case 8:data=t.sent,this.activities=data.data.map(function(t){return Object(n.a)({},t,{_showDetails:!1,key:"".concat(t._id,"/").concat(t.revision)})}),this.totalRows=this.activities.length,t.next=16;break;case 13:t.prev=13,t.t0=t.catch(5),this.$axiosGetErrorHandler(t.t0);case 16:t.next=21;break;case 18:t.prev=18,t.t1=t.catch(1),this.axiosPostError(t.t1,"Erreur avec la suppression de l'activité");case 21:case"end":return t.stop()}},t,this,[[1,18],[5,13]])}));return function(e){return t.apply(this,arguments)}}(),axiosPostError:function(t,e){this.$axiosPostErrorHandler(t,"Activité non trouvée","Cette activité existe déjà",e)},toggleEnabled:function(t,e){e?this.submitUpdate(t,{enabled:!1}):this.submitUpdate(t,{enabled:!0})},rowSelected:function(t){if(this.hideRowDetails(),t.length){var e=t[0];e._showDetails=!e._showDetails}},hideRowDetails:function(){this.activities.map(function(t){return t._showDetails=!1})},resetNew:function(t){var e=this;t&&t.preventDefault(),this.newForm.activity="",this.showNewForm=!1,this.$nextTick(function(){e.showNewForm=!0})}},components:{ActivityUpdateForm:v}},m=Object(l.a)(h,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("b-jumbotron",{staticClass:"mt-3 mb-3 pt-4 pb-4",attrs:{fluid:"","bg-variant":"dark","text-variant":"light",header:"Module: Activity",lead:"Change l'activité de Derpy au hasard."}}),t._v(" "),r("b-container",[r("b-breadcrumb",{attrs:{items:t.$store.state.breadcrumbs.crumbs}})],1),t._v(" "),t.activities.length?r("b-container",{staticClass:"pb-5"},[r("b-table",{attrs:{hover:"","head-variant":"light",selectable:"","select-mode":"single",selectedVariant:"primary","current-page":t.currentPage,"per-page":t.perPage,items:t.activities,fields:t.fields},on:{"row-selected":t.rowSelected},scopedSlots:t._u([{key:"enabledCheckBox",fn:function(e){return[r("b-form",[r("b-form-checkbox",{attrs:{name:"check-button",switch:""},on:{change:function(r){return t.toggleEnabled(e.item._id,e.item.enabled)}},model:{value:e.item.enabled,callback:function(r){t.$set(e.item,"enabled",r)},expression:"row.item.enabled"}})],1)]}},{key:"row-details",fn:function(e){return[r("ActivityUpdateForm",{attrs:{data:e.item},on:{submitUpdate:t.submitUpdate,submitDelete:t.submitDelete}})]}}],null,!1,4069556963)}),t._v(" "),r("b-row",[r("b-col",[r("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.totalRows,"per-page":t.perPage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1),t._v(" "),r("b-col",[r("b-form-group",{staticClass:"mb-0",attrs:{"label-cols-sm":"3",label:"Nombre par page"}},[r("b-form-select",{attrs:{options:t.pageOptions},model:{value:t.perPage,callback:function(e){t.perPage=e},expression:"perPage"}})],1)],1)],1)],1):t._e(),t._v(" "),r("b-container",[r("h4",[t._v("Ajouter une nouvelle activité")]),t._v(" "),r("hr",{staticClass:"border-primary"}),t._v(" "),t.showNewForm?r("b-form",{on:{submit:t.submitNew,reset:t.resetNew}},[r("b-form-group",[r("b-form-input",{attrs:{placeholder:"L'activité",required:""},model:{value:t.newForm.activity,callback:function(e){t.$set(t.newForm,"activity",e)},expression:"newForm.activity"}})],1),t._v(" "),r("b-button",{attrs:{type:"submit",variant:"primary"}},[t._v("Ajouter")]),t._v(" "),r("b-button",{attrs:{type:"reset"}},[t._v("Annuler")])],1):t._e()],1)],1)},[],!1,null,null,null);e.default=m.exports}}]);