exports.ids=[12],exports.modules={34:function(e,t,o){"use strict";o.r(t);var r={name:"rss-update-form",props:["data","logos"],data:()=>({rssID:null,name:null,feed:null,nameURL:null,logo:null,description:null,logoSelectOptions:null}),mounted(){this.rssID=this.data._id,this.name=this.data.name,this.feed=this.data.feed,this.nameURL=this.data.nameURL,this.logo=this.data.logo,this.description=this.data.description},methods:{submitUpdate(e){e.preventDefault(),this.$emit("submitUpdate",this.rssID,{name:this.name,feed:this.feed,nameURL:this.nameURL,logo:this.logo,description:this.description})},submitDelete(){this.$emit("submitDelete",this.rssID)}}},n=o(1),l={name:"rss",fetch:({store:e,redirect:t})=>e.state.auth.isAuth&&e.state.auth.hasAccess?void 0:t("/"),head(){return{titleTemplate:"%s - "+this.title}},data:()=>({title:"Module: RSS",feeds:[],fields:[{key:"name",label:"Nom",sortable:!0,thStyle:{width:"20%"}},{key:"feed",label:"Flux",sortable:!0,thStyle:{width:"40%"}},{key:"enabledCheckBox",label:"Activée",sortable:!0,thStyle:{width:"20%"}}],totalRows:1,currentPage:1,perPage:10,pageOptions:[5,10,15],showNewForm:!0,newForm:{name:null,feed:null,nameURL:null,logo:null,description:null},logos:[],logoSelectOptions:[],showNewLogo:!0,newLogo:null,uploadDisabled:!0,isUploading:!1,uploadProgress:50,uploadProgressMax:100,uploadVariant:"primary"}),async asyncData({$axios:e}){let t,o;try{t=(await e.$get("rss")).map(e=>({...e,_showDetails:!1,key:`${e._id}/${e.revision}`}))}catch(e){t=[]}try{o=await e.$get("rss/logos")}catch(e){o=[]}return{feeds:t,logos:o}},mounted(){this.$store.dispatch("breadcrumbs/setCrumbs",this.$route.path),this.totalRows=this.feeds.length,this.setLogosSelect()},computed:{newLogoValidation(){return this.newLogo?("image/jpeg"===this.newLogo.type||"image/png"===this.newLogo.type)&&(!(this.newLogo.size>1048576)&&/^[a-z0-9]{2,22}(\.jpeg|\.jpg|\.png){1}$/.test(this.newLogo.name)):null}},methods:{async submitNewRss(e){e.preventDefault();try{await this.$axios({method:"post",data:{name:this.newForm.name,feed:this.newForm.feed,nameURL:this.newForm.nameURL,logo:this.newForm.logo,description:this.newForm.description},url:"rss"});this.$toast.success("Flux ajouté"),this.resetNewRss();try{const data=await this.$axios.$get("rss");this.feeds=data.map(e=>({...e,_showDetails:!1,key:`${e._id}/${e.revision}`})),this.totalRows=this.feeds.length}catch(e){this.$axiosGetErrorHandler(e)}}catch(e){this.axiosPostError(e,"Erreur avec l'ajout du flux")}},async submitUpdateRss(e,data){this.hideRowDetails();try{if(0===(await this.$axios({method:"patch",data:data,url:"rss/"+e})).data.modifed)this.$toast.warning("Aucune modification");else{this.$toast.success("Flux modifié");try{const data=await this.$axios.$get("rss");this.feeds=data.map(e=>({...e,_showDetails:!1,key:`${e._id}/${e.revision}`})),this.totalRows=this.feeds.length}catch(e){this.$axiosGetErrorHandler(e)}}}catch(e){this.axiosPostError(e,"Erreur avec l'édition du flux")}},async submitDeleteRss(e){this.hideRowDetails();try{await this.$axios({method:"delete",url:"rss/"+e}),this.$toast.success("Flux supprimé");try{const data=await this.$axios.$get("rss");this.feeds=data.map(e=>({...e,_showDetails:!1,key:`${e._id}/${e.revision}`})),this.totalRows=this.feeds.length}catch(e){this.$axiosGetErrorHandler(e)}}catch(e){this.axiosPostError(e,"Erreur avec la suppression du flux")}},axiosPostError(e,t){this.$axiosPostErrorHandler(e,"Flux non trouvé","Ce flux existe déjà",t)},toggleEnabled(e,t){t?this.submitUpdateRss(e,{enabled:!1}):this.submitUpdateRss(e,{enabled:!0})},rowSelected(e){if(this.hideRowDetails(),!e.length)return;const t=e[0];t._showDetails=!t._showDetails},hideRowDetails(){this.feeds.map(e=>e._showDetails=!1)},resetNewRss(e){e&&e.preventDefault(),this.newForm.name=null,this.newForm.feed=null,this.newForm.nameURL=null,this.newForm.logo=null,this.newForm.description=null,this.showNewForm=!1,this.$nextTick(()=>{this.showNewForm=!0})},async uploadFile(e){e.preventDefault();try{const e=this,t=new FormData;t.append("file",this.newLogo),this.isUploading=!0;await this.$axios({method:"post",url:"rss/upload",data:t,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(t){e.uploadProgress=Math.round(t.loaded/t.total*100)}});this.uploadVariant="success",this.$toast.success("Fichier téléversé"),setTimeout(()=>{this.newLogo=null,this.isUploading=!1,this.uploadProgress=0,this.uploadVariant="primary",this.getLogos()},5e3)}catch(e){const code=parseInt(e.response&&e.response.status);404===code?this.$toast.warning("Aucun fichier téléversé"):415===code?this.$toast.warning("Mauvais type de fichier"):413===code?this.$toast.warning("Fichier trop volumineux"):400===code?this.$toast.warning("Nom de fichier ou extension invalide"):409===code?this.$toast.warning("Le fichier existe déjà"):this.$toast.warning("Erreur avec le téléversement du fichier"),this.uploadVariant="danger",setTimeout(()=>{this.newLogo=null,this.isUploading=!1,this.uploadProgress=0,this.uploadVariant="primary"},5e3)}},async getLogos(){try{const data=await this.$axios.$get("rss/logos");this.logos=data,this.setLogosSelect()}catch(e){this.logos=[],this.setLogosSelect()}},setLogosSelect(){this.logoSelectOptions=[{value:"null",text:"Le logo du site",disabled:!0,slot:"first"}];for(let i=0;i<this.logos.length;i++){const e=this.logos[i],t=e.match(/^([a-z0-9]{2,22})(\.jpeg|\.jpg|\.png){1}$/)[1];this.logoSelectOptions.push({value:e,text:t})}}},components:{RssUpdateForm:Object(n.a)(r,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:" p-3"},[o("b-form",{on:{submit:e.submitUpdate}},[o("b-form-group",[o("b-form-input",{attrs:{placeholder:"Le nom du flux",required:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),o("b-form-group",[o("b-form-input",{attrs:{placeholder:"L'addresse du flux",required:""},model:{value:e.feed,callback:function(t){e.feed=t},expression:"feed"}})],1),e._v(" "),o("b-form-group",[o("b-form-input",{attrs:{placeholder:"L'addresse du site",required:""},model:{value:e.nameURL,callback:function(t){e.nameURL=t},expression:"nameURL"}})],1),e._v(" "),o("b-form-group",[o("b-form-input",{attrs:{placeholder:"La description/slogan du site"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})],1),e._v(" "),o("b-row",[o("b-col",[o("b-form-select",{attrs:{options:e.logos},model:{value:e.logo,callback:function(t){e.logo=t},expression:"logo"}})],1),e._v(" "),o("b-col",[o("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Modifier")]),e._v(" "),e.$store.state.auth.isOwner?o("b-button",{staticClass:"float-right",attrs:{variant:"danger"},on:{click:e.submitDelete}},[e._v("Supprimer")]):e._e()],1)],1)],1)],1)},[],!1,null,null,"31014b9b").exports}},d=Object(n.a)(l,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("b-jumbotron",{staticClass:"mt-3 mb-3 pt-4 pb-4",attrs:{fluid:"","bg-variant":"dark","text-variant":"light",header:"Module: RSS",lead:"Poste les nouvelles entrées d'un flux RSS."}}),e._ssrNode(" "),o("b-container",[o("b-breadcrumb",{attrs:{items:e.$store.state.breadcrumbs.crumbs}})],1),e._ssrNode(" "),e.feeds.length?o("b-container",{staticClass:"pb-5"},[o("b-table",{attrs:{hover:"","head-variant":"light",selectable:"","select-mode":"single",selectedVariant:"primary","current-page":e.currentPage,"per-page":e.perPage,items:e.feeds,fields:e.fields},on:{"row-selected":e.rowSelected},scopedSlots:e._u([{key:"enabledCheckBox",fn:function(t){return[o("b-form",[o("b-form-checkbox",{attrs:{name:"check-button",switch:""},on:{change:function(o){return e.toggleEnabled(t.item._id,t.item.enabled)}},model:{value:t.item.enabled,callback:function(o){e.$set(t.item,"enabled",o)},expression:"row.item.enabled"}})],1)]}},{key:"row-details",fn:function(t){return[o("RssUpdateForm",{attrs:{data:t.item,logos:e.logoSelectOptions},on:{submitUpdate:e.submitUpdateRss,submitDelete:e.submitDeleteRss}})]}}],null,!1,210524737)}),e._v(" "),o("b-row",[o("b-col",[o("b-pagination",{staticClass:"my-0",attrs:{"total-rows":e.totalRows,"per-page":e.perPage},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}})],1),e._v(" "),o("b-col",[o("b-form-group",{staticClass:"mb-0",attrs:{"label-cols-sm":"3",label:"Nombre par page"}},[o("b-form-select",{attrs:{options:e.pageOptions},model:{value:e.perPage,callback:function(t){e.perPage=t},expression:"perPage"}})],1)],1)],1)],1):e._e(),e._ssrNode(" "),o("b-container",{staticClass:"pb-5"},[o("h4",[e._v("Ajouter un nouveau flux")]),e._v(" "),o("hr",{staticClass:"border-primary"}),e._v(" "),e.showNewForm?o("b-form",{on:{submit:e.submitNewRss,reset:e.resetNewRss}},[o("b-form-group",[o("b-form-input",{attrs:{placeholder:"Le nom du flux",required:""},model:{value:e.newForm.name,callback:function(t){e.$set(e.newForm,"name",t)},expression:"newForm.name"}})],1),e._v(" "),o("b-form-group",[o("b-form-input",{attrs:{placeholder:"L'addresse du flux",required:""},model:{value:e.newForm.feed,callback:function(t){e.$set(e.newForm,"feed",t)},expression:"newForm.feed"}})],1),e._v(" "),o("b-form-group",[o("b-form-input",{attrs:{placeholder:"L'addresse du site",required:""},model:{value:e.newForm.nameURL,callback:function(t){e.$set(e.newForm,"nameURL",t)},expression:"newForm.nameURL"}})],1),e._v(" "),o("b-form-group",[o("b-form-input",{attrs:{placeholder:"La description/slogan du site"},model:{value:e.newForm.description,callback:function(t){e.$set(e.newForm,"description",t)},expression:"newForm.description"}})],1),e._v(" "),o("b-row",[o("b-col",[o("b-form-select",{attrs:{options:e.logoSelectOptions},model:{value:e.newForm.logo,callback:function(t){e.$set(e.newForm,"logo",t)},expression:"newForm.logo"}})],1),e._v(" "),o("b-col",[o("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Ajouter")]),e._v(" "),o("b-button",{attrs:{type:"reset"}},[e._v("Annuler")])],1)],1)],1):e._e()],1),e._ssrNode(" "),o("b-container",[o("h4",[e._v("Ajouter un nouveau logo")]),e._v(" "),o("hr",{staticClass:"border-primary"}),e._v(" "),e.showNewLogo?o("b-form",[e.isUploading?o("b-form-group",[o("b-progress",{attrs:{max:e.uploadProgressMax,height:"2.5rem","show-progress":"","show-value":""}},[o("b-progress-bar",{attrs:{value:e.uploadProgress,variant:e.uploadVariant}},[e._v("\r\n                        Progression: "),o("strong",[e._v(e._s(e.uploadProgress)+"%")])])],1)],1):o("b-form-group",[o("b-form-file",{attrs:{name:"newLogo",placeholder:"Choisir un fichier jpeg ou png",accept:".jpeg,.jpg,.png",state:e.newLogoValidation},model:{value:e.newLogo,callback:function(t){e.newLogo=t},expression:"newLogo"}}),e._v(" "),o("b-form-invalid-feedback",{attrs:{state:e.newLogoValidation}},[e._v("\r\n                    Le fichier doit être un jpeg ou un png de 1mo max, le nom ne doit contenir que des lettres minuscules ou des chiffres et être compris entre 2 et 22 charactères.\r\n                ")])],1),e._v(" "),o("b-form-group",[o("b-button",{attrs:{variant:"primary",disabled:!e.newLogoValidation},on:{click:e.uploadFile}},[e._v("Téléverser")]),e._v(" "),o("b-button",{attrs:{variant:"secondary"},on:{click:function(t){e.newLogo=null}}},[e._v("Annuler")])],1)],1):e._e()],1)],2)},[],!1,null,null,"9157affe");t.default=d.exports}};
//# sourceMappingURL=8e69af8a4d6c68908476.js.map