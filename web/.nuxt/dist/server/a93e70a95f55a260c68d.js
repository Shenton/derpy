exports.ids=[4],exports.modules={30:function(t,e,n){"use strict";n.r(e);var o={name:"module-configuration",props:["data"],data:()=>({name:null,channelTypes:{},form:{enabled:null,textChannel:null,textChannels:[],voiceChannel:null,voiceChannels:[]},textOptions:[],voiceOptions:[]}),mounted(){this.name=this.data.name,this.channelTypes=this.getChannelTypes(this.data.channels),this.textOptions=this.$store.state.botinfo.info.textOptions,this.voiceOptions=this.$store.state.botinfo.info.voiceOptions,this.setDefaultValues()},methods:{setDefaultValues(){this.form.enabled=this.data.enabled,this.form.textChannel=this.data.textChannel,this.form.textChannels=this.data.textChannels,this.form.voiceChannel=this.data.voiceChannel,this.form.voiceChannels=this.data.voiceChannels},getChannelTypes(t){const e={textChannel:!1,textChannels:!1,voiceChannel:!1,voiceChannels:!1};return t>=8&&(e.voiceChannels=!0,t-=8),t>=4&&(e.voiceChannel=!0,t-=4),t>=2&&(e.textChannels=!0,t-=2),1==t&&(e.textChannel=!0),e},submitUpdate(t){t.preventDefault(),this.$emit("submitUpdate",this.name,{enabled:this.form.enabled,textChannel:this.form.textChannel,textChannels:this.form.textChannels,voiceChannel:this.form.voiceChannel,voiceChannels:this.form.voiceChannels})}}},r=n(1),l=Object(r.a)(o,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.data.channels>0?n("b-container",{staticClass:"mb-3"},[n("h2",[t._v(t._s(t.name))]),t._v(" "),n("hr",{staticClass:"border-primary"}),t._v(" "),n("b-form",{on:{submit:t.submitUpdate}},[n("b-card",{staticClass:"mb-3",attrs:{"no-body":""}},[n("b-tabs",{attrs:{"content-class":"mt-3",fill:"",card:""}},[n("b-tab",{attrs:{title:"Canal (texte)",disabled:!t.channelTypes.textChannel}},[n("b-form-group",{attrs:{label:"Sélectionne sur quel canal textuel le module doit poster"}},[n("b-form-radio-group",{attrs:{options:t.textOptions,stacked:""},model:{value:t.form.textChannel,callback:function(e){t.$set(t.form,"textChannel",e)},expression:"form.textChannel"}})],1)],1),t._v(" "),n("b-tab",{attrs:{title:"Canaux (texte)",disabled:!t.channelTypes.textChannels}},[n("b-form-group",{attrs:{label:"Sélectionne sur quels canaux textuels le module doit poster"}},[n("b-form-checkbox-group",{attrs:{options:t.textOptions,switches:"",stacked:""},model:{value:t.form.textChannels,callback:function(e){t.$set(t.form,"textChannels",e)},expression:"form.textChannels"}})],1)],1),t._v(" "),n("b-tab",{attrs:{title:"Canal (voix)",disabled:!t.channelTypes.voiceChannel}},[n("b-form-group",{attrs:{label:"Sélectionne sur quel canal vocal le module doit poster"}},[n("b-form-radio-group",{attrs:{options:t.voiceOptions,stacked:""},model:{value:t.form.voiceChannel,callback:function(e){t.$set(t.form,"voiceChannel",e)},expression:"form.voiceChannel"}})],1)],1),t._v(" "),n("b-tab",{attrs:{title:"Canaux (voix)",disabled:!t.channelTypes.voiceChannels}},[n("b-form-group",{attrs:{label:"Sélectionne sur quels canaux vocaux le module doit poster"}},[n("b-form-checkbox-group",{attrs:{options:t.voiceOptions,switches:"",stacked:""},model:{value:t.form.voiceChannels,callback:function(e){t.$set(t.form,"voiceChannels",e)},expression:"form.voiceChannels"}})],1)],1)],1)],1),t._v(" "),n("b-row",[n("b-col",[n("b-button",{attrs:{type:"submit",block:"",variant:"primary"}},[t._v("Appliquer les modifications")])],1),t._v(" "),n("b-col",[n("b-button",{attrs:{block:"",variant:"secondary"},on:{click:function(e){return t.setDefaultValues()}}},[t._v("Annuler les modifications")])],1)],1)],1)],1):t._e()},[],!1,null,null,"82dc5412").exports,c=n(27),d={name:"modules",fetch:({store:t,redirect:e})=>t.state.auth.isAuth&&t.state.auth.hasAccess?void 0:e("/"),head(){return{titleTemplate:"%s - "+this.title}},data:()=>({title:"Administration: Modules",modulesData:[],fields:[{key:"name",label:"Module",sortable:!0,thStyle:{width:"80%"}},{key:"enabledCheckBox",label:"Activé",sortable:!0,thStyle:{width:"20%"}}],totalRows:1,currentPage:1,perPage:10,pageOptions:[5,10,15],restarting:!1,restartVariant:"primary"}),async asyncData({$axios:t}){try{return{modulesData:(await t.$get("modules")).map(t=>({...t,key:`${t._id}/${t.revision}`}))}}catch(t){}},mounted(){this.$store.dispatch("breadcrumbs/setCrumbs",this.$route.path),this.$store.dispatch("botinfo/getInfo"),this.totalRows=this.modulesData.length},methods:{async submitUpdate(t,data){try{if(0===(await this.$axios({method:"patch",data:data,url:"modules/"+t})).data.modifed)this.$toast.warning("Aucune modification");else{this.$toast.success("Module modifié");try{const t=(await this.$axios.$get("modules")).map(t=>({...t,key:`${t._id}/${t.revision}`}));this.modulesData=t,this.totalRows=this.modulesData.length}catch(t){this.$axiosGetErrorHandler(t)}}}catch(t){this.$axiosPostErrorHandler(t,"Module non trouvé","Ce module existe déjà","Erreur avec l'édition du module")}},toggleEnabled(t,e){e?this.submitUpdate(t,{enabled:!1}):this.submitUpdate(t,{enabled:!0})},async restartDerpy(){try{this.restarting=!0;await this.$axios.$get("system/restart");this.restarting=!1,this.restartVariant="success",Object(c.setTimeout)(()=>this.restartVariant="primary",3e3)}catch(t){this.restarting=!1,this.restartVariant="danger",Object(c.setTimeout)(()=>this.restartVariant="primary",3e3)}}},components:{moduleConfiguration:l}},h=Object(r.a)(d,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("b-jumbotron",{staticClass:"mt-3 mb-3 pt-4 pb-4",attrs:{fluid:"","bg-variant":"dark","text-variant":"light",header:"Administration: Modules",lead:"Configuration générique des modules."}}),t._ssrNode(" "),n("b-container",[n("b-breadcrumb",{attrs:{items:t.$store.state.breadcrumbs.crumbs}})],1),t._ssrNode(" "),n("b-container",{staticClass:"pb-5"},[n("b-table",{attrs:{hover:"","head-variant":"light","current-page":t.currentPage,"per-page":t.perPage,items:t.modulesData,fields:t.fields},scopedSlots:t._u([{key:"enabledCheckBox",fn:function(e){return[n("b-form",[n("b-form-checkbox",{attrs:{name:"check-button",switch:""},on:{change:function(n){return t.toggleEnabled(e.item.name,e.item.enabled)}},model:{value:e.item.enabled,callback:function(n){t.$set(e.item,"enabled",n)},expression:"row.item.enabled"}})],1)]}}])}),t._v(" "),n("b-row",[n("b-col",[n("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.totalRows,"per-page":t.perPage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1),t._v(" "),n("b-col",[n("b-form-group",{staticClass:"mb-0",attrs:{"label-cols-sm":"3",label:"Nombre par page"}},[n("b-form-select",{attrs:{options:t.pageOptions},model:{value:t.perPage,callback:function(e){t.perPage=e},expression:"perPage"}})],1)],1)],1),t._v(" "),n("hr",{staticClass:"border-primary"}),t._v(" "),n("p",[t._v("Pour activer/désactiver les modules il faut redémarrer Derpy.")]),t._v(" "),n("b-button",{attrs:{block:"",variant:t.restartVariant},on:{click:function(e){return t.restartDerpy()}}},[t.restarting?n("b-spinner",{attrs:{small:""}}):n("span",[t._v("Redémarrer Derpy")])],1)],1),t._ssrNode(" "),t._l(t.modulesData,function(e){return n("moduleConfiguration",{key:e.key,attrs:{data:e},on:{submitUpdate:t.submitUpdate}})})],2)},[],!1,null,null,"70b6dd96");e.default=h.exports}};
//# sourceMappingURL=a93e70a95f55a260c68d.js.map