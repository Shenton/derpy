exports.ids=[11],exports.modules={31:function(e,t,r){"use strict";r.r(t);var o={name:"response-update-form",props:["data"],data:()=>({options:[{value:"exact",text:"Exact"},{value:"contain",text:"Contient"}],responseID:"",trigger:"",response:"",type:""}),mounted(){this.responseID=this.data._id,this.trigger=this.data.trigger,this.response=this.data.response,this.type=this.data.type},methods:{submitUpdate(e){e.preventDefault(),this.$emit("submitUpdate",this.responseID,{trigger:this.trigger,response:this.response,type:this.type})},submitDelete(){this.$emit("submitDelete",this.responseID)}}},n=r(1),l={name:"Response",fetch:({store:e,redirect:t})=>e.state.auth.isAuth&&e.state.auth.hasAccess?void 0:t("/"),head(){return{titleTemplate:"%s - "+this.title}},data:()=>({title:"Module: Response",responses:[],fields:[{key:"trigger",label:"Déclencheur",sortable:!0,thStyle:{width:"40%"}},{key:"response",label:"Réponse",sortable:!0,thStyle:{width:"40%"}},{key:"enabledCheckBox",label:"Activée",sortable:!0,thStyle:{width:"20%"}}],totalRows:1,currentPage:1,perPage:10,pageOptions:[5,10,15],showNewForm:!0,newForm:{trigger:"",response:"",type:"exact"},responseSelectOptions:[{value:"exact",text:"Exact"},{value:"contain",text:"Contient"}]}),async asyncData({$axios:e}){try{return{responses:(await e.$get("response")).map(e=>({...e,_showDetails:!1,key:`${e._id}/${e.revision}`}))}}catch(e){}},mounted(){this.$store.dispatch("breadcrumbs/setCrumbs",this.$route.path),this.totalRows=this.responses.length},methods:{async submitNew(e){e.preventDefault();try{await this.$axios({method:"post",data:{trigger:this.newForm.trigger,response:this.newForm.response,type:this.newForm.type},url:"response"});this.$toast.success("Réponse ajoutée"),this.resetNew();try{const data=await this.$axios.$get("response");this.responses=data.map(e=>({...e,_showDetails:!1,key:`${e._id}/${e.revision}`})),this.totalRows=this.responses.length}catch(e){this.$axiosGetErrorHandler(e)}}catch(e){this.axiosPostError(e,"Erreur avec l'ajout de la réponse")}},async submitUpdate(e,data){this.hideRowDetails();try{if(0===(await this.$axios({method:"patch",data:data,url:"response/"+e})).data.modifed)this.$toast.warning("Aucune modification");else{this.$toast.success("Réponse modifiée");try{const data=await this.$axios.$get("response");this.responses=data.map(e=>({...e,_showDetails:!1,key:`${e._id}/${e.revision}`})),this.totalRows=this.responses.length}catch(e){this.$axiosGetErrorHandler(e)}}}catch(e){this.axiosPostError(e,"Erreur avec l'édition de la réponse")}},async submitDelete(e){this.hideRowDetails();try{await this.$axios({method:"delete",url:"response/"+e}),this.$toast.success("Réponse supprimée");try{const data=await this.$axios.$get("response");this.responses=data.map(e=>({...e,_showDetails:!1,key:`${e._id}/${e.revision}`})),this.totalRows=this.responses.length}catch(e){this.$axiosGetErrorHandler(e)}}catch(e){this.axiosPostError(e,"Erreur avec la suppression de la réponse")}},axiosPostError(e,t){this.$axiosPostErrorHandler(e,"Réponse non trouvée","Cette réponse existe déjà",t)},toggleEnabled(e,t){t?this.submitUpdate(e,{enabled:!1}):this.submitUpdate(e,{enabled:!0})},rowSelected(e){if(this.hideRowDetails(),!e.length)return;const t=e[0];t._showDetails=!t._showDetails},hideRowDetails(){this.responses.map(e=>e._showDetails=!1)},resetNew(e){e&&e.preventDefault(),this.newForm.trigger="",this.newForm.response="",this.newForm.type="exact",this.showNewForm=!1,this.$nextTick(()=>{this.showNewForm=!0})}},components:{ResponseUpdateForm:Object(n.a)(o,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:" p-3"},[r("b-form",{on:{submit:e.submitUpdate}},[r("b-form-group",[r("b-form-input",{attrs:{required:""},model:{value:e.trigger,callback:function(t){e.trigger=t},expression:"trigger"}})],1),e._v(" "),r("b-form-group",[r("b-form-input",{attrs:{required:""},model:{value:e.response,callback:function(t){e.response=t},expression:"response"}})],1),e._v(" "),r("b-form-group",[r("b-row",[r("b-col",[r("b-form-select",{attrs:{options:e.options},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}})],1),e._v(" "),r("b-col",[r("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Modifier")]),e._v(" "),e.$store.state.auth.isOwner?r("b-button",{staticClass:"float-right",attrs:{variant:"danger"},on:{click:e.submitDelete}},[e._v("Supprimer")]):e._e()],1)],1)],1)],1)],1)},[],!1,null,null,"7d9242de").exports}},c=Object(n.a)(l,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-jumbotron",{staticClass:"mt-3 mb-3 pt-4 pb-4",attrs:{fluid:"","bg-variant":"dark","text-variant":"light",header:"Module: Response",lead:"Définis un déclencheur, le bot postera la réponse."}}),e._ssrNode(" "),r("b-container",[r("b-breadcrumb",{attrs:{items:e.$store.state.breadcrumbs.crumbs}})],1),e._ssrNode(" "),e.responses.length?r("b-container",{staticClass:"pb-5"},[r("b-table",{attrs:{hover:"","head-variant":"light",selectable:"","select-mode":"single",selectedVariant:"primary","current-page":e.currentPage,"per-page":e.perPage,items:e.responses,fields:e.fields},on:{"row-selected":e.rowSelected},scopedSlots:e._u([{key:"enabledCheckBox",fn:function(t){return[r("b-form",[r("b-form-checkbox",{attrs:{name:"check-button",switch:""},on:{change:function(r){return e.toggleEnabled(t.item._id,t.item.enabled)}},model:{value:t.item.enabled,callback:function(r){e.$set(t.item,"enabled",r)},expression:"row.item.enabled"}})],1)]}},{key:"row-details",fn:function(t){return[r("ResponseUpdateForm",{attrs:{data:t.item},on:{submitUpdate:e.submitUpdate,submitDelete:e.submitDelete}})]}}],null,!1,3824784109)}),e._v(" "),r("b-row",[r("b-col",[r("b-pagination",{staticClass:"my-0",attrs:{"total-rows":e.totalRows,"per-page":e.perPage},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}})],1),e._v(" "),r("b-col",[r("b-form-group",{staticClass:"mb-0",attrs:{"label-cols-sm":"3",label:"Nombre par page"}},[r("b-form-select",{attrs:{options:e.pageOptions},model:{value:e.perPage,callback:function(t){e.perPage=t},expression:"perPage"}})],1)],1)],1)],1):e._e(),e._ssrNode(" "),r("b-container",[r("h4",[e._v("Ajouter une nouvelle réponse")]),e._v(" "),r("hr",{staticClass:"border-primary"}),e._v(" "),e.showNewForm?r("b-form",{on:{submit:e.submitNew,reset:e.resetNew}},[r("b-form-group",[r("b-form-input",{attrs:{placeholder:"Le déclencheur",required:""},model:{value:e.newForm.trigger,callback:function(t){e.$set(e.newForm,"trigger",t)},expression:"newForm.trigger"}})],1),e._v(" "),r("b-form-group",[r("b-form-input",{attrs:{placeholder:"La réponse",required:""},model:{value:e.newForm.response,callback:function(t){e.$set(e.newForm,"response",t)},expression:"newForm.response"}})],1),e._v(" "),r("b-row",[r("b-col",[r("b-form-select",{attrs:{options:e.responseSelectOptions},model:{value:e.newForm.type,callback:function(t){e.$set(e.newForm,"type",t)},expression:"newForm.type"}})],1),e._v(" "),r("b-col",[r("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Ajouter")]),e._v(" "),r("b-button",{attrs:{type:"reset"}},[e._v("Annuler")])],1)],1)],1):e._e()],1)],2)},[],!1,null,null,"2c1afebc");t.default=c.exports}};
//# sourceMappingURL=23eb87e72453b32a66e2.js.map