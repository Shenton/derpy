exports.ids=[1],exports.modules={33:function(t,e,o){"use strict";o.r(e);var r={name:"command-update-form",props:["data"],data:()=>({commandID:null,allowedChannels:[],roles:[],form:{allowedChannels:[],allowedRoles:[]},textOptions:[],rolesOptions:[]}),mounted(){this.textOptions=this.$store.state.botinfo.info.textOptions,this.rolesOptions=this.$store.state.botinfo.info.rolesOptions,this.commandID=this.data._id,this.allowedChannels=this.data.allowedChannels,this.allowedRoles=this.data.allowedRoles,this.setDefaultValues()},methods:{setDefaultValues(){this.form.allowedChannels=this.data.allowedChannels,this.form.allowedRoles=this.data.allowedRoles},submitUpdate(t){t.preventDefault(),this.$emit("submitUpdate",this.commandID,{allowedChannels:this.form.allowedChannels,allowedRoles:this.form.allowedRoles})}}},n=o(1),l={name:"Commandes",fetch:({store:t,redirect:e})=>t.state.auth.isAuth&&t.state.auth.isOwner?void 0:e("/"),head(){return{titleTemplate:"%s - "+this.title}},data:()=>({title:"Administration: Commandes",commands:[],fields:[{key:"name",label:"Commande",sortable:!0,thStyle:{width:"80%"}},{key:"enabledCheckBox",label:"Activée",sortable:!0,thStyle:{width:"20%"}}],totalRows:1,currentPage:1,perPage:10,pageOptions:[5,10,15],restarting:!1,restartVariant:"primary"}),async asyncData({$axios:t}){try{return{commands:(await t.$get("commands")).map(t=>({...t,_showDetails:!1,key:`${t._id}/${t.revision}`}))}}catch(t){}},mounted(){this.$store.dispatch("breadcrumbs/setCrumbs",this.$route.path),this.totalRows=this.commands.length},methods:{async submitUpdate(t,data){this.hideRowDetails();try{if(0===(await this.$axios({method:"patch",data:data,url:"commands/"+t})).data.modifed)this.$toast.warning("Aucune modification");else{this.$toast.success("Commande modifiée");try{const data=await this.$axios.$get("commands");this.commands=data.map(t=>({...t,_showDetails:!1,key:`${t._id}/${t.revision}`})),this.totalRows=this.commands.length}catch(t){this.$axiosGetErrorHandler(t)}}}catch(t){this.axiosPostError(t,"Erreur avec l'édition de la commande")}},axiosPostError(t,e){this.$axiosPostErrorHandler(t,"Commande non trouvée","Cette commande existe déjà",e)},toggleEnabled(t,e){e?this.submitUpdate(t,{enabled:!1}):this.submitUpdate(t,{enabled:!0})},rowSelected(t){if(this.hideRowDetails(),!t.length)return;const e=t[0];e._showDetails=!e._showDetails},hideRowDetails(){this.commands.map(t=>t._showDetails=!1)},async restartDerpy(){try{this.restarting=!0;await this.$axios.$get("system/restart");this.restarting=!1,this.restartVariant="success",setTimeout(()=>this.restartVariant="primary",3e3)}catch(t){this.restarting=!1,this.restartVariant="danger",setTimeout(()=>this.restartVariant="primary",3e3)}}},components:{CommandUpdateForm:Object(n.a)(r,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:" p-3"},[o("b-form",{on:{submit:t.submitUpdate}},[o("b-card",{staticClass:"mb-3",attrs:{"no-body":""}},[o("b-tabs",{attrs:{"content-class":"mt-3",fill:"",card:""}},[o("b-tab",{attrs:{title:"Canaux"}},[o("b-form-group",{attrs:{label:"Sélectionne sur quels canaux textuels la commande peut être exécutée"}},[o("b-form-checkbox-group",{attrs:{options:t.textOptions,switches:"",stacked:""},model:{value:t.form.allowedChannels,callback:function(e){t.$set(t.form,"allowedChannels",e)},expression:"form.allowedChannels"}})],1)],1),t._v(" "),o("b-tab",{attrs:{title:"Roles"}},[o("b-form-group",{attrs:{label:"Sélectionne quels roles peuvent exécuter la commande"}},[o("b-form-checkbox-group",{attrs:{options:t.rolesOptions,switches:"",stacked:""},model:{value:t.form.allowedRoles,callback:function(e){t.$set(t.form,"allowedRoles",e)},expression:"form.allowedRoles"}})],1)],1)],1)],1),t._v(" "),o("b-row",[o("b-col",[o("b-button",{attrs:{type:"submit",block:"",variant:"primary"}},[t._v("Appliquer les modifications")])],1),t._v(" "),o("b-col",[o("b-button",{attrs:{block:"",variant:"secondary"},on:{click:function(e){return t.setDefaultValues()}}},[t._v("Annuler les modifications")])],1)],1)],1)],1)},[],!1,null,null,"f06c58d8").exports}};var m=Object(n.a)(l,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-jumbotron",{staticClass:"mt-3 mb-3 pt-4 pb-4",attrs:{fluid:"","bg-variant":"dark","text-variant":"light",header:"Administration: Commandes",lead:"Configure les commandes de Derpy."}}),t._ssrNode(" "),o("b-container",[o("b-breadcrumb",{attrs:{items:t.$store.state.breadcrumbs.crumbs}})],1),t._ssrNode(" "),t.commands.length?o("b-container",{staticClass:"pb-5"},[o("b-table",{attrs:{hover:"","head-variant":"light",selectable:"","select-mode":"single",selectedVariant:"primary","current-page":t.currentPage,"per-page":t.perPage,items:t.commands,fields:t.fields},on:{"row-selected":t.rowSelected},scopedSlots:t._u([{key:"enabledCheckBox",fn:function(e){return[o("b-form",[o("b-form-checkbox",{attrs:{name:"check-button",switch:""},on:{change:function(o){return t.toggleEnabled(e.item._id,e.item.enabled)}},model:{value:e.item.enabled,callback:function(o){t.$set(e.item,"enabled",o)},expression:"row.item.enabled"}})],1)]}},{key:"row-details",fn:function(e){return[o("CommandUpdateForm",{attrs:{data:e.item},on:{submitUpdate:t.submitUpdate}})]}}],null,!1,972628415)}),t._v(" "),o("b-row",[o("b-col",[o("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.totalRows,"per-page":t.perPage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1),t._v(" "),o("b-col",[o("b-form-group",{staticClass:"mb-0",attrs:{"label-cols-sm":"3",label:"Nombre par page"}},[o("b-form-select",{attrs:{options:t.pageOptions},model:{value:t.perPage,callback:function(e){t.perPage=e},expression:"perPage"}})],1)],1)],1),t._v(" "),o("hr",{staticClass:"border-primary"}),t._v(" "),o("p",[t._v("Pour que les modifications soit prisent en compte, il faut redémarrer Derpy.")]),t._v(" "),o("b-button",{attrs:{block:"",variant:t.restartVariant},on:{click:function(e){return t.restartDerpy()}}},[t.restarting?o("b-spinner",{attrs:{small:""}}):o("span",[t._v("Redémarrer Derpy")])],1)],1):t._e()],2)},[],!1,function(t){},null,"23ecb94a");e.default=m.exports}};
//# sourceMappingURL=633f833ec58b057d1d83.js.map