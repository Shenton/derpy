(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{200:function(e,t,r){"use strict";r.r(t);r(51),r(7);var o=r(0),n=(r(42),r(13)),l={name:"rss-update-form",props:["data","logos"],data:function(){return{rssID:null,name:null,feed:null,nameURL:null,logo:null,description:null,logoSelectOptions:null}},mounted:function(){this.rssID=this.data._id,this.name=this.data.name,this.feed=this.data.feed,this.nameURL=this.data.nameURL,this.logo=this.data.logo,this.description=this.data.description},methods:{submitUpdate:function(e){e.preventDefault(),this.$emit("submitUpdate",this.rssID,{name:this.name,feed:this.feed,nameURL:this.nameURL,logo:this.logo,description:this.description})},submitDelete:function(){this.$emit("submitDelete",this.rssID)}}},c=r(24),d=Object(c.a)(l,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:" p-3"},[r("b-form",{on:{submit:e.submitUpdate}},[r("b-form-group",[r("b-form-input",{attrs:{placeholder:"Le nom du flux",required:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),r("b-form-group",[r("b-form-input",{attrs:{placeholder:"L'addresse du flux",required:""},model:{value:e.feed,callback:function(t){e.feed=t},expression:"feed"}})],1),e._v(" "),r("b-form-group",[r("b-form-input",{attrs:{placeholder:"L'addresse du site",required:""},model:{value:e.nameURL,callback:function(t){e.nameURL=t},expression:"nameURL"}})],1),e._v(" "),r("b-form-group",[r("b-form-input",{attrs:{placeholder:"La description/slogan du site"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})],1),e._v(" "),r("b-row",[r("b-col",[r("b-form-select",{attrs:{options:e.logos},model:{value:e.logo,callback:function(t){e.logo=t},expression:"logo"}})],1),e._v(" "),r("b-col",[r("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Modifier")]),e._v(" "),e.$store.state.auth.isOwner?r("b-button",{staticClass:"float-right",attrs:{variant:"danger"},on:{click:e.submitDelete}},[e._v("Supprimer")]):e._e()],1)],1)],1)],1)},[],!1,null,null,null).exports,m={name:"rss",fetch:function(e){var t=e.store,r=e.redirect;return t.state.auth.isAuth&&t.state.auth.hasAccess?void 0:r("/")},head:function(){return{titleTemplate:"%s - "+this.title}},data:function(){return{title:"Module: RSS",feeds:[],fields:[{key:"name",label:"Nom",sortable:!0,thStyle:{width:"20%"}},{key:"feed",label:"Flux",sortable:!0,thStyle:{width:"40%"}},{key:"enabledCheckBox",label:"Activée",sortable:!0,thStyle:{width:"20%"}}],totalRows:1,currentPage:1,perPage:10,pageOptions:[5,10,15],showNewForm:!0,newForm:{name:null,feed:null,nameURL:null,logo:null,description:null},logos:[],logoSelectOptions:[],showNewLogo:!0,newLogo:null,uploadDisabled:!0,isUploading:!1,uploadProgress:50,uploadProgressMax:100,uploadVariant:"primary"}},asyncData:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(t){var r,n,l,data,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.$axios,e.prev=1,e.next=4,r.$get("rss");case 4:data=e.sent,n=data.map(function(e){return Object(o.a)({},e,{_showDetails:!1,key:"".concat(e._id,"/").concat(e.revision)})}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),n=[];case 11:return e.prev=11,e.next=14,r.$get("rss/logos");case 14:c=e.sent,l=c,e.next=21;break;case 18:e.prev=18,e.t1=e.catch(11),l=[];case 21:return e.abrupt("return",{feeds:n,logos:l});case 22:case"end":return e.stop()}},e,null,[[1,8],[11,18]])}));return function(t){return e.apply(this,arguments)}}(),mounted:function(){this.$store.dispatch("breadcrumbs/setCrumbs",this.$route.path),this.totalRows=this.feeds.length,this.setLogosSelect()},computed:{newLogoValidation:function(){return this.newLogo?("image/jpeg"===this.newLogo.type||"image/png"===this.newLogo.type)&&(!(this.newLogo.size>1048576)&&/^[a-z0-9]{2,22}(\.jpeg|\.jpg|\.png){1}$/.test(this.newLogo.name)):null}},methods:{submitNewRss:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(t){var data;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,this.$axios({method:"post",data:{name:this.newForm.name,feed:this.newForm.feed,nameURL:this.newForm.nameURL,logo:this.newForm.logo,description:this.newForm.description},url:"rss"});case 4:return e.sent,this.$toast.success("Flux ajouté"),this.resetNewRss(),e.prev=7,e.next=10,this.$axios.$get("rss");case 10:data=e.sent,this.feeds=data.map(function(e){return Object(o.a)({},e,{_showDetails:!1,key:"".concat(e._id,"/").concat(e.revision)})}),this.totalRows=this.feeds.length,e.next=18;break;case 15:e.prev=15,e.t0=e.catch(7),this.$axiosGetErrorHandler(e.t0);case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(1),this.axiosPostError(e.t1,"Erreur avec l'ajout du flux");case 23:case"end":return e.stop()}},e,this,[[1,20],[7,15]])}));return function(t){return e.apply(this,arguments)}}(),submitUpdateRss:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(t,data){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.hideRowDetails(),e.prev=1,e.next=4,this.$axios({method:"patch",data:data,url:"rss/"+t});case 4:if(0!==e.sent.data.modifed){e.next=9;break}this.$toast.warning("Aucune modification"),e.next=21;break;case 9:return this.$toast.success("Flux modifié"),e.prev=10,e.next=13,this.$axios.$get("rss");case 13:r=e.sent,this.feeds=r.map(function(e){return Object(o.a)({},e,{_showDetails:!1,key:"".concat(e._id,"/").concat(e.revision)})}),this.totalRows=this.feeds.length,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(10),this.$axiosGetErrorHandler(e.t0);case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(1),this.axiosPostError(e.t1,"Erreur avec l'édition du flux");case 26:case"end":return e.stop()}},e,this,[[1,23],[10,18]])}));return function(t,r){return e.apply(this,arguments)}}(),submitDeleteRss:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(t){var data;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.hideRowDetails(),e.prev=1,e.next=4,this.$axios({method:"delete",url:"rss/"+t});case 4:return this.$toast.success("Flux supprimé"),e.prev=5,e.next=8,this.$axios.$get("rss");case 8:data=e.sent,this.feeds=data.map(function(e){return Object(o.a)({},e,{_showDetails:!1,key:"".concat(e._id,"/").concat(e.revision)})}),this.totalRows=this.feeds.length,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),this.$axiosGetErrorHandler(e.t0);case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(1),this.axiosPostError(e.t1,"Erreur avec la suppression du flux");case 21:case"end":return e.stop()}},e,this,[[1,18],[5,13]])}));return function(t){return e.apply(this,arguments)}}(),axiosPostError:function(e,t){this.$axiosPostErrorHandler(e,"Flux non trouvé","Ce flux existe déjà",t)},toggleEnabled:function(e,t){t?this.submitUpdateRss(e,{enabled:!1}):this.submitUpdateRss(e,{enabled:!0})},rowSelected:function(e){if(this.hideRowDetails(),e.length){var t=e[0];t._showDetails=!t._showDetails}},hideRowDetails:function(){this.feeds.map(function(e){return e._showDetails=!1})},resetNewRss:function(e){var t=this;e&&e.preventDefault(),this.newForm.name=null,this.newForm.feed=null,this.newForm.nameURL=null,this.newForm.logo=null,this.newForm.description=null,this.showNewForm=!1,this.$nextTick(function(){t.showNewForm=!0})},uploadFile:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(t){var r,o,code,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,r=this,(o=new FormData).append("file",this.newLogo),this.isUploading=!0,e.next=8,this.$axios({method:"post",url:"rss/upload",data:o,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){r.uploadProgress=Math.round(e.loaded/e.total*100)}});case 8:e.sent,this.uploadVariant="success",this.$toast.success("Fichier téléversé"),setTimeout(function(){n.newLogo=null,n.isUploading=!1,n.uploadProgress=0,n.uploadVariant="primary",n.getLogos()},5e3),e.next=20;break;case 14:e.prev=14,e.t0=e.catch(1),404===(code=parseInt(e.t0.response&&e.t0.response.status))?this.$toast.warning("Aucun fichier téléversé"):415===code?this.$toast.warning("Mauvais type de fichier"):413===code?this.$toast.warning("Fichier trop volumineux"):400===code?this.$toast.warning("Nom de fichier ou extension invalide"):409===code?this.$toast.warning("Le fichier existe déjà"):this.$toast.warning("Erreur avec le téléversement du fichier"),this.uploadVariant="danger",setTimeout(function(){n.newLogo=null,n.isUploading=!1,n.uploadProgress=0,n.uploadVariant="primary"},5e3);case 20:case"end":return e.stop()}},e,this,[[1,14]])}));return function(t){return e.apply(this,arguments)}}(),getLogos:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(){var data;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$axios.$get("rss/logos");case 3:data=e.sent,this.logos=data,this.setLogosSelect(),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),this.logos=[],this.setLogosSelect();case 12:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}(),setLogosSelect:function(){this.logoSelectOptions=[{value:"null",text:"Le logo du site",disabled:!0,slot:"first"}];for(var i=0;i<this.logos.length;i++){var e=this.logos[i],t=e.match(/^([a-z0-9]{2,22})(\.jpeg|\.jpg|\.png){1}$/)[1];this.logoSelectOptions.push({value:e,text:t})}}},components:{RssUpdateForm:d}},h=Object(c.a)(m,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-jumbotron",{staticClass:"mt-3 mb-3 pt-4 pb-4",attrs:{fluid:"","bg-variant":"dark","text-variant":"light",header:"Module: RSS",lead:"Poste les nouvelles entrées d'un flux RSS."}}),e._v(" "),r("b-container",[r("b-breadcrumb",{attrs:{items:e.$store.state.breadcrumbs.crumbs}})],1),e._v(" "),e.feeds.length?r("b-container",{staticClass:"pb-5"},[r("b-table",{attrs:{hover:"","head-variant":"light",selectable:"","select-mode":"single",selectedVariant:"primary","current-page":e.currentPage,"per-page":e.perPage,items:e.feeds,fields:e.fields},on:{"row-selected":e.rowSelected},scopedSlots:e._u([{key:"enabledCheckBox",fn:function(t){return[r("b-form",[r("b-form-checkbox",{attrs:{name:"check-button",switch:""},on:{change:function(r){return e.toggleEnabled(t.item._id,t.item.enabled)}},model:{value:t.item.enabled,callback:function(r){e.$set(t.item,"enabled",r)},expression:"row.item.enabled"}})],1)]}},{key:"row-details",fn:function(t){return[r("RssUpdateForm",{attrs:{data:t.item,logos:e.logoSelectOptions},on:{submitUpdate:e.submitUpdateRss,submitDelete:e.submitDeleteRss}})]}}],null,!1,210524737)}),e._v(" "),r("b-row",[r("b-col",[r("b-pagination",{staticClass:"my-0",attrs:{"total-rows":e.totalRows,"per-page":e.perPage},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}})],1),e._v(" "),r("b-col",[r("b-form-group",{staticClass:"mb-0",attrs:{"label-cols-sm":"3",label:"Nombre par page"}},[r("b-form-select",{attrs:{options:e.pageOptions},model:{value:e.perPage,callback:function(t){e.perPage=t},expression:"perPage"}})],1)],1)],1)],1):e._e(),e._v(" "),r("b-container",{staticClass:"pb-5"},[r("h4",[e._v("Ajouter un nouveau flux")]),e._v(" "),r("hr",{staticClass:"border-primary"}),e._v(" "),e.showNewForm?r("b-form",{on:{submit:e.submitNewRss,reset:e.resetNewRss}},[r("b-form-group",[r("b-form-input",{attrs:{placeholder:"Le nom du flux",required:""},model:{value:e.newForm.name,callback:function(t){e.$set(e.newForm,"name",t)},expression:"newForm.name"}})],1),e._v(" "),r("b-form-group",[r("b-form-input",{attrs:{placeholder:"L'addresse du flux",required:""},model:{value:e.newForm.feed,callback:function(t){e.$set(e.newForm,"feed",t)},expression:"newForm.feed"}})],1),e._v(" "),r("b-form-group",[r("b-form-input",{attrs:{placeholder:"L'addresse du site",required:""},model:{value:e.newForm.nameURL,callback:function(t){e.$set(e.newForm,"nameURL",t)},expression:"newForm.nameURL"}})],1),e._v(" "),r("b-form-group",[r("b-form-input",{attrs:{placeholder:"La description/slogan du site"},model:{value:e.newForm.description,callback:function(t){e.$set(e.newForm,"description",t)},expression:"newForm.description"}})],1),e._v(" "),r("b-row",[r("b-col",[r("b-form-select",{attrs:{options:e.logoSelectOptions},model:{value:e.newForm.logo,callback:function(t){e.$set(e.newForm,"logo",t)},expression:"newForm.logo"}})],1),e._v(" "),r("b-col",[r("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Ajouter")]),e._v(" "),r("b-button",{attrs:{type:"reset"}},[e._v("Annuler")])],1)],1)],1):e._e()],1),e._v(" "),r("b-container",[r("h4",[e._v("Ajouter un nouveau logo")]),e._v(" "),r("hr",{staticClass:"border-primary"}),e._v(" "),e.showNewLogo?r("b-form",[e.isUploading?r("b-form-group",[r("b-progress",{attrs:{max:e.uploadProgressMax,height:"2.5rem","show-progress":"","show-value":""}},[r("b-progress-bar",{attrs:{value:e.uploadProgress,variant:e.uploadVariant}},[e._v("\r\n                        Progression: "),r("strong",[e._v(e._s(e.uploadProgress)+"%")])])],1)],1):r("b-form-group",[r("b-form-file",{attrs:{name:"newLogo",placeholder:"Choisir un fichier jpeg ou png",accept:".jpeg,.jpg,.png",state:e.newLogoValidation},model:{value:e.newLogo,callback:function(t){e.newLogo=t},expression:"newLogo"}}),e._v(" "),r("b-form-invalid-feedback",{attrs:{state:e.newLogoValidation}},[e._v("\r\n                    Le fichier doit être un jpeg ou un png de 1mo max, le nom ne doit contenir que des lettres minuscules ou des chiffres et être compris entre 2 et 22 charactères.\r\n                ")])],1),e._v(" "),r("b-form-group",[r("b-button",{attrs:{variant:"primary",disabled:!e.newLogoValidation},on:{click:e.uploadFile}},[e._v("Téléverser")]),e._v(" "),r("b-button",{attrs:{variant:"secondary"},on:{click:function(t){e.newLogo=null}}},[e._v("Annuler")])],1)],1):e._e()],1)],1)},[],!1,null,null,null);t.default=h.exports}}]);